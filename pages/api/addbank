import authRoute from "@/utils/middlewares/authRoute"
import { PrismaClient } from '@prisma/client';
const prisma = new PrismaClient();
// Not so sure if it's correct
// Not finished
async function addBank(req, res){
    if (req.method == "POST"){
      // Combine these into one if statement
      if (
         //!req.body?.PBankID
         !req.body?.BankName
        || !req.body?.AccountNumber
        || !req.body?.BankID
           ) {
        await prisma.$disconnect()
        return res.status(400).json({ message: 'All field must be filled.' })
      }
      // Check if the user is really a publisher
      if(req.user.role.RoleID != 2){
        await prisma.$disconnect()
        return res.status(400).json({ message: 'Only Publisher can create promotion.' })
      }
      const bank = await prisma.publisherbank.create({
        data: {
          publisher: {
            connect: {
              PublisherID: req.user.role.RoleID
            }
          },
          BankName: req.body.BankName,
          AccountNumber: req.body.AccountNumber,
          bank:{
            connect: {
              BankID: req.body.BankID
            }
          },
        }
      })
    await prisma.$disconnect()
  }
} 

export default authRoute(addBank,prisma);